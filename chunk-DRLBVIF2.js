import{a as V,b as Ue}from"./chunk-IN7WPWQK.js";import{a as Le,b as Be,c as Re,d as Z,e as ee,f as E,g as We,i as D,j as T}from"./chunk-EMHLBX52.js";import{b as I,c as Ve,d as te,e as x,f as je}from"./chunk-CKPELB7C.js";import{a as Y,b as S}from"./chunk-DMSMQKJ4.js";import{h as M}from"./chunk-DJ3JZSNC.js";import{b as J,c as R,e as K,f as Te,g as we,h as Pe,i as Q,j as Ne,k as Oe,l as Fe,m as X,n as ke}from"./chunk-YD42VMBR.js";import{Pa as y,Qa as C,Va as A,f as H,i as Ee,j as Ie,k as _,pa as xe,xa as De}from"./chunk-LAVAPTOJ.js";import{$ as L,Cb as f,Db as b,L as j,La as c,Mb as Ce,Nb as a,Ob as w,Qa as s,Rb as P,Sb as N,Tb as O,Vb as F,Xb as Se,Ya as h,aa as B,cb as u,cc as g,dc as k,ec as q,fc as Ae,gc as Me,i as he,ia as ye,j as _e,kb as p,sb as o,tb as t,ub as d,vb as W,wb as U,yb as G}from"./chunk-HDHCGP6B.js";var He=()=>({"min-width":"100%"});function Je(r,e){r&1&&(o(0,"tr")(1,"th"),a(2,"ID"),t(),o(3,"th"),a(4,"N\xFAmero"),t(),o(5,"th"),a(6,"Titular"),t(),o(7,"th"),a(8,"Tipo"),t(),o(9,"th"),a(10,"Saldo"),t(),o(11,"th"),a(12,"Estado"),t(),o(13,"th",4),a(14,"Acciones"),t()())}function Ke(r,e){if(r&1){let n=G();o(0,"tr")(1,"td",5),a(2),g(3,"fallback"),t(),o(4,"td",6),a(5),g(6,"fallback"),t(),o(7,"td",7),a(8),g(9,"fallback"),t(),o(10,"td",8),a(11),g(12,"fallback"),t(),o(13,"td",9),a(14),g(15,"currency"),t(),o(16,"td",10),a(17),g(18,"fallback"),t(),o(19,"td",11)(20,"div",12)(21,"p-button",13),f("click",function(m){let l=L(n).$implicit,v=b();return B(v.onEdit(l,m))}),t(),o(22,"p-button",14),f("click",function(m){let l=L(n).$implicit,v=b();return B(v.onDelete(l,m))}),t()()()()}if(r&2){let n=e.$implicit;c(2),w(k(3,6,n.id)),c(3),w(q(6,8,n.number,"-")),c(3),w(q(9,11,n.holder,"Sin titular")),c(3),w(q(12,14,n.type,"-")),c(3),w(Ae(15,17,n.balance,"\u20B2 ","symbol","1.0-0")),c(3),w(q(18,22,n.status,"-"))}}var ie=class r{_list=[];set list(e){this._list=e}action=new ye;constructor(){}onEdit(e,n){n.stopPropagation(),this.action.emit({type:"edit",value:e})}onDelete(e,n){n.stopPropagation(),this.action.emit({type:"delete",value:e})}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=h({type:r,selectors:[["app-account-table"]],inputs:{list:"list"},outputs:{action:"action"},decls:4,vars:3,consts:[[1,"table-wrapper"],["responsiveLayout","scroll",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[2,"text-align","center"],["data-label","ID"],["data-label","N\xFAmero"],["data-label","Titular"],["data-label","Tipo"],["data-label","Saldo"],["data-label","Estado"],["data-label","Acciones",2,"text-align","center","white-space","nowrap"],[1,"action-buttons"],["icon","pi pi-pencil","styleClass","p-button-text p-button-edit",3,"click"],["icon","pi pi-trash","styleClass","p-button-text p-button-delete",3,"click"]],template:function(n,i){n&1&&(o(0,"div",0)(1,"p-table",1),u(2,Je,15,0,"ng-template",2)(3,Ke,23,25,"ng-template",3),t()()),n&2&&(c(),p("value",i._list)("tableStyle",F(2,He)))},dependencies:[_,Ie,Ue,M,De,C,y,E,I,A,x,D,We,S,T],encapsulation:2,changeDetection:0})};var Ye=()=>({label:"Activo",value:1}),Ze=()=>({label:"Inactivo",value:0}),et=(r,e)=>[r,e],oe=class r{constructor(e,n,i,m){this.ref=e;this.config=n;this.appService=i;this.ui=m}model={id:0,holder:"",number:"",balance:0,status:1,currencyId:0,customerId:0};currencies=[];customers=[];ngOnInit(){this.loadCurrencies(),this.loadCustomers();let e=this.config.data?.account;e&&(this.model={id:e.id,holder:e.holder,number:e.number,balance:e.balance,status:e.status==="ACTIVO"?1:0,currencyId:e.currency,customerId:e.customer})}save(){if(!this.model.id){this.ui.showError("Error","No se encontr\xF3 el ID de la cuenta.");return}this.appService.accountApiService.updateAccount(this.model).subscribe({next:()=>{this.ui.showSuccess("Cuenta actualizada","Se guardaron los cambios correctamente"),this.ref.close({success:!0})},error:e=>{this.ui.showError("Error","No se pudo actualizar la cuenta"),console.error("Error al actualizar cuenta:",e)}})}loadCurrencies(){this.appService.currencyApiService.getCurrencyList().subscribe({next:e=>this.currencies=e,error:e=>console.error("Error al cargar monedas",e)})}loadCustomers(){this.appService.customerApiService.listCustomer().subscribe({next:e=>this.customers=e,error:e=>console.error("Error al cargar clientes",e)})}static \u0275fac=function(n){return new(n||r)(s(te),s(Ve),s(Z),s(V))};static \u0275cmp=h({type:r,selectors:[["app-account-edit"]],decls:26,vars:14,consts:[[1,"form-field"],["for","holder"],["id","holder","pInputText","",3,"ngModelChange","ngModel"],["for","number"],["id","number","pInputText","",3,"ngModelChange","ngModel"],["for","balance"],["id","balance","type","number","pInputText","",3,"ngModelChange","ngModel"],["for","status"],["inputId","status","optionLabel","label","optionValue","value",3,"ngModelChange","options","ngModel"],["for","currencyId"],["inputId","currencyId","optionLabel","name","optionValue","id",3,"ngModelChange","options","ngModel"],["for","customerId"],["inputId","customerId","optionLabel","name","optionValue","id",3,"ngModelChange","options","ngModel"],[1,"form-actions"],["label","Actualizar","styleClass","p-button-success",3,"click"]],template:function(n,i){n&1&&(o(0,"div",0)(1,"label",1),a(2,"Titular"),t(),o(3,"input",2),O("ngModelChange",function(l){return N(i.model.holder,l)||(i.model.holder=l),l}),t()(),o(4,"div",0)(5,"label",3),a(6,"N\xFAmero de Cuenta"),t(),o(7,"input",4),O("ngModelChange",function(l){return N(i.model.number,l)||(i.model.number=l),l}),t()(),o(8,"div",0)(9,"label",5),a(10,"Balance"),t(),o(11,"input",6),O("ngModelChange",function(l){return N(i.model.balance,l)||(i.model.balance=l),l}),t()(),o(12,"div",0)(13,"label",7),a(14,"Estado"),t(),o(15,"p-dropdown",8),O("ngModelChange",function(l){return N(i.model.status,l)||(i.model.status=l),l}),t()(),o(16,"div",0)(17,"label",9),a(18,"Moneda"),t(),o(19,"p-dropdown",10),O("ngModelChange",function(l){return N(i.model.currencyId,l)||(i.model.currencyId=l),l}),t()(),o(20,"div",0)(21,"label",11),a(22,"Cliente"),t(),o(23,"p-dropdown",12),O("ngModelChange",function(l){return N(i.model.customerId,l)||(i.model.customerId=l),l}),t()(),o(24,"div",13)(25,"p-button",14),f("click",function(){return i.save()}),t()()),n&2&&(c(3),P("ngModel",i.model.holder),c(4),P("ngModel",i.model.number),c(4),P("ngModel",i.model.balance),c(4),p("options",Se(11,et,F(9,Ye),F(10,Ze))),P("ngModel",i.model.status),c(4),p("options",i.currencies),P("ngModel",i.model.currencyId),c(4),p("options",i.customers),P("ngModel",i.model.customerId))},dependencies:[M,C,y,E,ee,I,A,x,D,S,Y,T,X,J,Q,K,we,_],styles:[".form-container[_ngcontent-%COMP%]{background-color:#fff;color:#000;padding:2rem;border-radius:12px;max-width:600px;margin:2rem auto;box-shadow:0 0 20px #0000001a}.form-field[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:700;margin-bottom:.5rem;color:#000}input[pInputText][_ngcontent-%COMP%], p-dropdown[_ngcontent-%COMP%]{width:100%;border-radius:6px;border:1px solid #ccc;padding:.5rem;background-color:#f9f9f9;color:#000}input[pInputText][_ngcontent-%COMP%]:focus, p-dropdown[_ngcontent-%COMP%]:focus{border-color:#000;box-shadow:0 0 3px #000}.p-error[_ngcontent-%COMP%]{font-size:.85rem;color:#e53935;margin-top:.25rem;display:block}.form-actions[_ngcontent-%COMP%]{text-align:right;margin-top:2rem}.p-button-success[_ngcontent-%COMP%]{background-color:#000!important;border:none;color:#fff;padding:.75rem 2rem;font-weight:700;border-radius:8px;transition:background-color .2s ease-in-out}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#333!important}"]})};function tt(r,e){r&1&&(o(0,"small",16),a(1," Campo obligatorio "),t())}function it(r,e){r&1&&(o(0,"small",16),a(1," Campo obligatorio "),t())}function ot(r,e){r&1&&(o(0,"small",16),a(1," Campo obligatorio "),t())}function nt(r,e){r&1&&(o(0,"small",16),a(1," Debe seleccionar una moneda "),t())}function rt(r,e){r&1&&(o(0,"small",16),a(1," Debe seleccionar un cliente "),t())}function at(r,e){if(r&1&&(W(0),o(1,"div",1)(2,"label",17),a(3,"Tipo de ahorro*"),t(),d(4,"p-dropdown",18),t(),U()),r&2){let n=b();c(4),p("options",n.savingTypes)}}function lt(r,e){r&1&&(W(0),o(1,"div",1)(2,"label",19),a(3,"L\xEDmite Operacional"),t(),d(4,"input",20),t(),o(5,"div",1)(6,"label",21),a(7,"Promedio Mensual"),t(),d(8,"input",22),t(),o(9,"div",1)(10,"label",23),a(11,"Inter\xE9s"),t(),d(12,"input",24),t(),U())}var ne=class r{constructor(e,n,i,m){this.fb=e;this.dialogRef=n;this.appService=i;this.uiService=m;this.accountForm=this.fb.group({holder:["",[R.required]],number:["",[R.required]],type:[0,[R.required]],currencyId:[0,[R.min(1)]],customerId:[0,[R.min(1)]],savingType:[null],operationalLimit:[null],monthAverage:[null],interest:[null]})}accountForm;customers=[];currencies=[];savingTypes=[{label:"Normal",value:1},{label:"Plazo Fijo",value:2}];accountTypes=[{label:"Cuenta de Ahorros",value:0},{label:"Cuenta Corriente",value:1}];ngOnInit(){this.loadCustomers(),this.loadCurrencies()}save(){if(this.accountForm.invalid){this.markAllAsTouched(),this.uiService.showWarn("Formulario inv\xE1lido","Por favor complete los campos obligatorios");return}let e=this.accountForm.value,n={holder:e.holder,number:e.number,type:e.type,currencyId:e.currencyId,customerId:e.customerId,createSavingAccount:{savingType:e.type===0?e.savingType:0},createCurrentAccount:{operationalLimit:e.type===1?e.operationalLimit:0,monthAverage:e.type===1?e.monthAverage:0,interest:e.type===1?e.interest:0}};this.appService.accountApiService.addAccount(n).subscribe({next:i=>{this.uiService.showSuccess("Cuenta creada","La cuenta fue registrada exitosamente"),this.dialogRef.close({success:!0,value:i})},error:i=>{this.uiService.showError("Error","No se pudo guardar la cuenta: "+(i.error?.message||"")),console.error(i)}})}markAllAsTouched(){Object.values(this.accountForm.controls).forEach(e=>{e.markAsTouched({onlySelf:!0})})}loadCustomers(){this.appService.customerApiService.listCustomer().subscribe({next:e=>this.customers=e,error:e=>console.error("Error al cargar clientes",e)})}loadCurrencies(){this.appService.currencyApiService.getCurrencyList().subscribe({next:e=>this.currencies=e,error:e=>console.error("Error al cargar monedas",e)})}static \u0275fac=function(n){return new(n||r)(s(Fe),s(te),s(Z),s(V))};static \u0275cmp=h({type:r,selectors:[["app-account-add"]],decls:30,vars:11,consts:[[1,"p-fluid",2,"padding","1rem","min-width","400px","max-width","600px",3,"ngSubmit","formGroup"],[1,"p-field"],["for","holder"],["id","holder","type","text","pInputText","","formControlName","holder"],["class","p-error",4,"ngIf"],["for","number"],["id","number","type","text","pInputText","","formControlName","number"],["for","type"],["inputId","type","formControlName","type","optionLabel","label","optionValue","value","placeholder","Seleccione un tipo de cuenta",3,"options"],["for","currencyId"],["inputId","currencyId","formControlName","currencyId","optionLabel","name","optionValue","id","placeholder","Seleccione una moneda",3,"options"],["for","customerId"],["inputId","customerId","formControlName","customerId","optionLabel","name","optionValue","id","placeholder","Seleccione un cliente",3,"options"],[4,"ngIf"],[2,"text-align","right","margin-top","1.5rem"],["label","Guardar","type","submit","styleClass","p-button-success"],[1,"p-error"],["for","savingType"],["inputId","savingType","formControlName","savingType","optionLabel","label","optionValue","value","placeholder","Seleccione tipo de ahorro",3,"options"],["for","operationalLimit"],["id","operationalLimit","type","number","pInputText","","formControlName","operationalLimit"],["for","monthAverage"],["id","monthAverage","type","number","pInputText","","formControlName","monthAverage"],["for","interest"],["id","interest","type","number","pInputText","","formControlName","interest"]],template:function(n,i){if(n&1&&(o(0,"form",0),f("ngSubmit",function(){return i.save()}),o(1,"div",1)(2,"label",2),a(3,"Titular*"),t(),d(4,"input",3),u(5,tt,2,0,"small",4),t(),o(6,"div",1)(7,"label",5),a(8,"N\xFAmero de cuenta*"),t(),d(9,"input",6),u(10,it,2,0,"small",4),t(),o(11,"div",1)(12,"label",7),a(13,"Tipo de cuenta*"),t(),d(14,"p-dropdown",8),u(15,ot,2,0,"small",4),t(),o(16,"div",1)(17,"label",9),a(18,"Moneda*"),t(),d(19,"p-dropdown",10),u(20,nt,2,0,"small",4),t(),o(21,"div",1)(22,"label",11),a(23,"Cliente*"),t(),d(24,"p-dropdown",12),u(25,rt,2,0,"small",4),t(),u(26,at,5,1,"ng-container",13)(27,lt,13,0,"ng-container",13),o(28,"div",14),d(29,"p-button",15),t()()),n&2){let m,l,v,z,$,be,ve;p("formGroup",i.accountForm),c(5),p("ngIf",((m=i.accountForm.get("holder"))==null?null:m.invalid)&&((m=i.accountForm.get("holder"))==null?null:m.touched)),c(5),p("ngIf",((l=i.accountForm.get("number"))==null?null:l.invalid)&&((l=i.accountForm.get("number"))==null?null:l.touched)),c(4),p("options",i.accountTypes),c(),p("ngIf",((v=i.accountForm.get("type"))==null?null:v.invalid)&&((v=i.accountForm.get("type"))==null?null:v.touched)),c(4),p("options",i.currencies),c(),p("ngIf",((z=i.accountForm.get("currencyId"))==null?null:z.invalid)&&((z=i.accountForm.get("currencyId"))==null?null:z.touched)),c(4),p("options",i.customers),c(),p("ngIf",(($=i.accountForm.get("customerId"))==null?null:$.invalid)&&(($=i.accountForm.get("customerId"))==null?null:$.touched)),c(),p("ngIf",((be=i.accountForm.get("type"))==null?null:be.value)===0),c(),p("ngIf",((ve=i.accountForm.get("type"))==null?null:ve.value)===1)}},dependencies:[_,H,X,Pe,J,Q,K,Te,ke,Ne,Oe,M,C,y,E,ee,I,A,x,D,S,Y,T],styles:[".form-container[_ngcontent-%COMP%]{background-color:#fff;color:#000;padding:2rem;border-radius:12px;max-width:600px;margin:2rem auto;box-shadow:0 0 20px #0000001a}.form-field[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:700;margin-bottom:.5rem;color:#000}input[pInputText][_ngcontent-%COMP%], p-dropdown[_ngcontent-%COMP%]{width:100%;border-radius:6px;border:1px solid #ccc;padding:.5rem;background-color:#f9f9f9;color:#000}input[pInputText][_ngcontent-%COMP%]:focus, p-dropdown[_ngcontent-%COMP%]:focus{border-color:#000;box-shadow:0 0 3px #000}.p-error[_ngcontent-%COMP%]{font-size:.85rem;color:#e53935;margin-top:.25rem;display:block}.form-actions[_ngcontent-%COMP%]{text-align:right;margin-top:2rem}.p-button-success[_ngcontent-%COMP%]{background-color:#000!important;border:none;color:#fff;padding:.75rem 2rem;font-weight:700;border-radius:8px;transition:background-color .2s ease-in-out}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#333!important}"]})};var ct=()=>[];function mt(r,e){r&1&&(W(0),o(1,"div",4),d(2,"p-progressSpinner",5),t(),U())}function pt(r,e){if(r&1){let n=G();o(0,"app-account-table",7),g(1,"async"),f("action",function(m){L(n);let l=b(2);return B(l.handleTableAction(m))}),t()}if(r&2){let n=b(2);p("list",k(1,1,n.accountList)||F(3,ct))}}function st(r,e){if(r&1&&(u(0,pt,2,4,"app-account-table",6),g(1,"async")),r&2){let n=b();p("ngIf",!k(1,1,n.loading$))}}var ze=class r{constructor(e,n,i,m){this.accountApiService=e;this.dialogService=n;this.confirmationService=i;this.uiService=m;this.loading$=this.uiService.loading$}accountList=new _e([]);loading$;destroy$=new he;ref=null;ngOnInit(){this.loadAccount()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.ref?.close()}loadAccount(){this.uiService.setLoading(!0),this.accountApiService.listAccount().pipe(j(this.destroy$)).subscribe({next:e=>this.accountList.next(e),error:e=>this.uiService.showError("Error al cargar cuentas",e.error?.message||"No se pudo obtener la lista"),complete:()=>this.uiService.setLoading(!1)})}onAdd(){this.ref=this.dialogService.open(ne,{header:"Nueva Cuenta",closable:!0,width:"70dvh",height:"80dvh"}),this.ref.onClose.pipe(j(this.destroy$)).subscribe(e=>{e?.success&&this.loadAccount(),this.ref=null})}onEdit(e){this.ref=this.dialogService.open(oe,{data:{account:e},header:"Editar Cuenta",closable:!0,width:"70dvh",height:"80dvh"}),this.ref.onClose.pipe(j(this.destroy$)).subscribe(n=>{n?.success&&this.loadAccount(),this.ref=null})}onDelete(e){e?.id&&this.confirmationService.confirm({message:`\xBFEst\xE1s seguro de que quer\xE9s eliminar la cuenta <b>${e.holder}</b>?`,header:"Eliminar Cuenta",icon:"pi pi-exclamation-triangle",acceptLabel:"Eliminar",rejectLabel:"Cancelar",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",accept:()=>{this.uiService.setLoading(!0),this.accountApiService.deleteAccount(e.id).pipe(j(this.destroy$)).subscribe({next:()=>{this.uiService.showSuccess("Cuenta eliminada",`${e.holder} fue eliminada correctamente.`),this.loadAccount()},error:n=>this.uiService.showError("Error al eliminar",n.error?.message||"No se pudo eliminar la cuenta."),complete:()=>this.uiService.setLoading(!1)})}})}handleTableAction(e){switch(e.type){case"edit":this.onEdit(e.value);break;case"delete":this.onDelete(e.value);break;default:console.warn("Acci\xF3n no reconocida:",e.type)}}static \u0275fac=function(n){return new(n||r)(s(Re),s(je),s(xe),s(V))};static \u0275cmp=h({type:r,selectors:[["app-account-page"]],decls:9,vars:7,consts:[["tableContent",""],[2,"display","flex","justify-content","space-between","align-items","center","margin-bottom","1rem"],["icon","pi pi-plus","label","Agregar","styleClass","p-button-outlined p-button-plain",3,"click","disabled"],[4,"ngIf","ngIfElse"],[2,"display","flex","justify-content","center","align-items","center","height","50vh"],["strokeWidth","4"],[3,"list","action",4,"ngIf"],[3,"action","list"]],template:function(n,i){if(n&1){let m=G();o(0,"div",1)(1,"h1"),a(2,"Cuentas"),t(),o(3,"p-button",2),g(4,"async"),f("click",function(){return L(m),B(i.onAdd())}),t()(),u(5,mt,3,0,"ng-container",3),g(6,"async"),u(7,st,2,3,"ng-template",null,0,Me)}if(n&2){let m=Ce(8);c(3),p("disabled",k(4,3,i.loading$)),c(2),p("ngIf",k(6,5,i.loading$))("ngIfElse",m)}},dependencies:[M,C,y,E,I,A,x,D,S,T,ie,_,H,Ee,Be,Le],encapsulation:2})};export{ze as AccountPage};
