import{a as L,b as Ge}from"./chunk-IN7WPWQK.js";import{a as We,b as Le,d as W,e as ee,f as w,g as Ve,h as Ue,i as k,j as N}from"./chunk-EMHLBX52.js";import{b as I,c as je,d as te,e as T,f as Re}from"./chunk-CKPELB7C.js";import{a as Z,b as E}from"./chunk-DMSMQKJ4.js";import{h as x}from"./chunk-DJ3JZSNC.js";import{b as Q,c as g,e as X,f as ke,g as Ne,h as Pe,j as Ae,k as Fe,l as Oe,m as Y,n as Be}from"./chunk-YD42VMBR.js";import{Pa as y,Qa as M,Va as D,f as K,i as we,k as B,pa as Ie,xa as Te}from"./chunk-LAVAPTOJ.js";import{$ as A,Cb as f,Db as O,L as j,La as m,Mb as Ee,Nb as l,Ob as $,Qa as p,Rb as b,Sb as h,Tb as v,Vb as P,Xb as De,Ya as _,_ as _e,a as be,aa as F,b as he,cb as c,cc as S,dc as H,ec as J,gc as xe,i as ve,ia as Se,j as Ce,kb as d,sb as o,tb as t,ub as u,vb as ye,wb as Me,yb as R}from"./chunk-HDHCGP6B.js";var Ke=()=>({label:"Activo",value:0}),Qe=()=>({label:"Inactivo",value:1}),Xe=(a,e)=>[a,e];function Ye(a,e){a&1&&(o(0,"small",23),l(1," Campo obligatorio "),t())}function Ze(a,e){a&1&&(o(0,"small",23),l(1," Campo obligatorio "),t())}function et(a,e){a&1&&(o(0,"small",23),l(1," Solo n\xFAmeros permitidos "),t())}function tt(a,e){a&1&&(o(0,"small",23),l(1," Campo obligatorio "),t())}function it(a,e){a&1&&(o(0,"small",23),l(1," Correo no v\xE1lido "),t())}function ot(a,e){a&1&&(o(0,"small",23),l(1," Campo obligatorio "),t())}function nt(a,e){a&1&&(o(0,"small",23),l(1," Debe seleccionar un banco "),t())}function rt(a,e){a&1&&(o(0,"small",23),l(1," Fecha obligatoria "),t())}var ie=class a{constructor(e,n,i,s){this.dialogRef=e;this.appService=n;this.fb=i;this.uiService=s;this.customerForm=this.fb.group({name:["",[g.required,g.minLength(2)]],lastname:["",[g.required,g.minLength(2)]],documentNumber:["",[g.required,g.pattern(/^[0-9]+$/)]],address:["",[g.required]],mail:["",[g.email]],phone:["",[g.required]],customerStatus:[0],birth:["",[g.required]],bankId:[0,[g.min(1)]]})}banks=[];customerForm;ngOnInit(){this.loadBanks()}save(){if(this.customerForm.invalid){this.markAllAsTouched(),this.uiService.showWarn("Formulario inv\xE1lido","Por favor complete todos los campos requeridos correctamente");return}let e=this.customerForm.value;this.appService.customerApiService.addCustomer(e).subscribe({next:()=>{this.uiService.showSuccess("\xC9xito","Cliente guardado correctamente"),this.dialogRef.close({success:!0,value:e})},error:n=>{this.uiService.showError("Error","No se pudo guardar el cliente: "+(n.error?.message||"")),console.error(n)}})}markAllAsTouched(){Object.values(this.customerForm.controls).forEach(e=>{e.markAsTouched({onlySelf:!0})})}loadBanks(){this.appService.bankApiService.listBanks().subscribe({next:e=>this.banks=e,error:e=>console.error("Error al cargar bancos",e)})}static \u0275fac=function(n){return new(n||a)(p(te),p(W),p(Oe),p(L))};static \u0275cmp=_({type:a,selectors:[["app-customer-add"]],decls:47,vars:16,consts:[[1,"p-fluid",2,"padding","1rem","min-width","400px","max-width","600px",3,"formGroup"],[1,"p-field"],["for","name"],["id","name","type","text","pInputText","","formControlName","name"],["class","p-error",4,"ngIf"],["for","lastname"],["id","lastname","type","text","pInputText","","formControlName","lastname"],["for","documentNumber"],["id","documentNumber","type","text","pInputText","","formControlName","documentNumber"],["for","address"],["id","address","type","text","pInputText","","formControlName","address"],["for","mail"],["id","mail","type","email","pInputText","","formControlName","mail"],["for","phone"],["id","phone","type","text","pInputText","","formControlName","phone"],["for","bank"],["inputId","bank","optionLabel","name","optionValue","id","formControlName","bankId","placeholder","Seleccione un banco",3,"options"],["for","customerStatus"],["inputId","customerStatus","formControlName","customerStatus","placeholder","Seleccione un estado",3,"options"],["for","birth"],["id","birth","type","date","pInputText","","formControlName","birth"],[2,"text-align","right","margin-top","1.5rem"],["label","Guardar","styleClass","p-button-success",3,"click"],[1,"p-error"]],template:function(n,i){if(n&1&&(o(0,"form",0)(1,"div",1)(2,"label",2),l(3,"Nombre*"),t(),u(4,"input",3),c(5,Ye,2,0,"small",4),t(),o(6,"div",1)(7,"label",5),l(8,"Apellido*"),t(),u(9,"input",6),c(10,Ze,2,0,"small",4),t(),o(11,"div",1)(12,"label",7),l(13,"Documento*"),t(),u(14,"input",8),c(15,et,2,0,"small",4),t(),o(16,"div",1)(17,"label",9),l(18,"Direcci\xF3n*"),t(),u(19,"input",10),c(20,tt,2,0,"small",4),t(),o(21,"div",1)(22,"label",11),l(23,"Correo electr\xF3nico"),t(),u(24,"input",12),c(25,it,2,0,"small",4),t(),o(26,"div",1)(27,"label",13),l(28,"Tel\xE9fono*"),t(),u(29,"input",14),c(30,ot,2,0,"small",4),t(),o(31,"div",1)(32,"label",15),l(33,"Banco*"),t(),u(34,"p-dropdown",16),c(35,nt,2,0,"small",4),t(),o(36,"div",1)(37,"label",17),l(38,"Estado del cliente"),t(),u(39,"p-dropdown",18),t(),o(40,"div",1)(41,"label",19),l(42,"Fecha de nacimiento*"),t(),u(43,"input",20),c(44,rt,2,0,"small",4),t(),o(45,"div",21)(46,"p-button",22),f("click",function(){return i.save()}),t()()()),n&2){let s,r,C,V,U,G,q,z;d("formGroup",i.customerForm),m(5),d("ngIf",((s=i.customerForm.get("name"))==null?null:s.invalid)&&((s=i.customerForm.get("name"))==null?null:s.touched)),m(5),d("ngIf",((r=i.customerForm.get("lastname"))==null?null:r.invalid)&&((r=i.customerForm.get("lastname"))==null?null:r.touched)),m(5),d("ngIf",((C=i.customerForm.get("documentNumber"))==null?null:C.invalid)&&((C=i.customerForm.get("documentNumber"))==null?null:C.touched)),m(5),d("ngIf",((V=i.customerForm.get("address"))==null?null:V.invalid)&&((V=i.customerForm.get("address"))==null?null:V.touched)),m(5),d("ngIf",((U=i.customerForm.get("mail"))==null?null:U.invalid)&&((U=i.customerForm.get("mail"))==null?null:U.touched)),m(5),d("ngIf",((G=i.customerForm.get("phone"))==null?null:G.invalid)&&((G=i.customerForm.get("phone"))==null?null:G.touched)),m(4),d("options",i.banks),m(),d("ngIf",((q=i.customerForm.get("bankId"))==null?null:q.invalid)&&((q=i.customerForm.get("bankId"))==null?null:q.touched)),m(4),d("options",De(13,Xe,P(11,Ke),P(12,Qe))),m(5),d("ngIf",((z=i.customerForm.get("birth"))==null?null:z.invalid)&&((z=i.customerForm.get("birth"))==null?null:z.touched))}},dependencies:[B,K,Y,Pe,Q,X,ke,Be,Ae,Fe,x,M,y,w,ee,I,D,T,k,E,Z,N],styles:[".form-container[_ngcontent-%COMP%]{background-color:#fff;color:#000;padding:2rem;border-radius:12px;max-width:600px;margin:2rem auto;box-shadow:0 0 20px #0000001a}.form-field[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:700;margin-bottom:.5rem;color:#000}input[pInputText][_ngcontent-%COMP%], p-dropdown[_ngcontent-%COMP%]{width:100%;border-radius:6px;border:1px solid #ccc;padding:.5rem;background-color:#f9f9f9;color:#000}input[pInputText][_ngcontent-%COMP%]:focus, p-dropdown[_ngcontent-%COMP%]:focus{border-color:#000;box-shadow:0 0 3px #000}.p-error[_ngcontent-%COMP%]{font-size:.85rem;color:#e53935;margin-top:.25rem;display:block}.form-actions[_ngcontent-%COMP%]{text-align:right;margin-top:2rem}.p-button-success[_ngcontent-%COMP%]{background-color:#000!important;border:none;color:#fff;padding:.75rem 2rem;font-weight:700;border-radius:8px;transition:background-color .2s ease-in-out}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#333!important}"]})};var oe=class a{constructor(e,n,i,s){this.ref=e;this.config=n;this.appService=i;this.ui=s}model={name:"",lastname:"",documentNumber:"",address:"",mail:"",phone:"",customerStatus:0,birth:"",bankId:0};banks=[];ngOnInit(){this.loadBanks(),this.config.data?.customer&&(this.model=he(be({},this.config.data.customer),{bankId:this.config.data.customer.bank?.id||this.config.data.customer.bankId}))}save(){this.appService.customerApiService.updateCustomer(this.model).subscribe({next:()=>{this.ui.showSuccess("Cliente actualizado","Se guardaron correctamente"),this.ref.close({success:!0})},error:e=>{this.ui.showError("Error al guardar","No se pudo actualizar el cliente"),console.error("Error al actualizar cliente",e)}})}loadBanks(){this.appService.bankApiService.listBanks().subscribe({next:e=>this.banks=e,error:e=>console.error("Error al cargar bancos",e)})}static \u0275fac=function(n){return new(n||a)(p(te),p(je),p(W),p(L))};static \u0275cmp=_({type:a,selectors:[["app-customer-edit"]],decls:35,vars:9,consts:[[1,"form-field"],["for","name"],["id","name","pInputText","",3,"ngModelChange","ngModel"],["for","lastname"],["id","lastname","pInputText","",3,"ngModelChange","ngModel"],["for","documentNumber"],["id","documentNumber","pInputText","",3,"ngModelChange","ngModel"],["for","bank"],["inputId","bank","optionLabel","name","optionValue","id",3,"ngModelChange","options","ngModel"],["for","phone"],["id","phone","pInputText","",3,"ngModelChange","ngModel"],["for","mail"],["id","mail","type","email","pInputText","",3,"ngModelChange","ngModel"],["for","address"],["id","address","pInputText","",3,"ngModelChange","ngModel"],["for","birth"],["id","birth","type","date","pInputText","",3,"ngModelChange","ngModel"],[1,"form-actions"],["label","Actualizar","styleClass","p-button-success",3,"click"]],template:function(n,i){n&1&&(o(0,"div")(1,"div",0)(2,"label",1),l(3,"Nombre"),t(),o(4,"input",2),v("ngModelChange",function(r){return h(i.model.name,r)||(i.model.name=r),r}),t()(),o(5,"div",0)(6,"label",3),l(7,"Apellido"),t(),o(8,"input",4),v("ngModelChange",function(r){return h(i.model.lastname,r)||(i.model.lastname=r),r}),t()(),o(9,"div",0)(10,"label",5),l(11,"Documento"),t(),o(12,"input",6),v("ngModelChange",function(r){return h(i.model.documentNumber,r)||(i.model.documentNumber=r),r}),t()(),o(13,"div",0)(14,"label",7),l(15,"Banco"),t(),o(16,"p-dropdown",8),v("ngModelChange",function(r){return h(i.model.bankId,r)||(i.model.bankId=r),r}),t()(),o(17,"div",0)(18,"label",9),l(19,"Tel\xE9fono"),t(),o(20,"input",10),v("ngModelChange",function(r){return h(i.model.phone,r)||(i.model.phone=r),r}),t()(),o(21,"div",0)(22,"label",11),l(23,"Correo electr\xF3nico"),t(),o(24,"input",12),v("ngModelChange",function(r){return h(i.model.mail,r)||(i.model.mail=r),r}),t()(),o(25,"div",0)(26,"label",13),l(27,"Direcci\xF3n"),t(),o(28,"input",14),v("ngModelChange",function(r){return h(i.model.address,r)||(i.model.address=r),r}),t()(),o(29,"div",0)(30,"label",15),l(31,"Nacimiento"),t(),o(32,"input",16),v("ngModelChange",function(r){return h(i.model.birth,r)||(i.model.birth=r),r}),t()(),o(33,"div",17)(34,"p-button",18),f("click",function(){return i.save()}),t()()()),n&2&&(m(4),b("ngModel",i.model.name),m(4),b("ngModel",i.model.lastname),m(4),b("ngModel",i.model.documentNumber),m(4),d("options",i.banks),b("ngModel",i.model.bankId),m(4),b("ngModel",i.model.phone),m(4),b("ngModel",i.model.mail),m(4),b("ngModel",i.model.address),m(4),b("ngModel",i.model.birth))},dependencies:[x,M,y,w,ee,I,D,T,k,E,Z,N,Y,Q,X,Ne,B],styles:[".form-container[_ngcontent-%COMP%]{background-color:#fff;color:#000;padding:2rem;border-radius:12px;max-width:600px;margin:2rem auto;box-shadow:0 0 20px #0000001a}.form-field[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:700;margin-bottom:.5rem;color:#000}input[pInputText][_ngcontent-%COMP%], p-dropdown[_ngcontent-%COMP%]{width:100%;border-radius:6px;border:1px solid #ccc;padding:.5rem;background-color:#f9f9f9;color:#000}input[pInputText][_ngcontent-%COMP%]:focus, p-dropdown[_ngcontent-%COMP%]:focus{border-color:#000;box-shadow:0 0 3px #000}.p-error[_ngcontent-%COMP%]{font-size:.85rem;color:#e53935;margin-top:.25rem;display:block}.form-actions[_ngcontent-%COMP%]{text-align:right;margin-top:2rem}.p-button-success[_ngcontent-%COMP%]{background-color:#000!important;border:none;color:#fff;padding:.75rem 2rem;font-weight:700;border-radius:8px;transition:background-color .2s ease-in-out}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#333!important}"]})};var lt=()=>({"min-width":"100%"});function mt(a,e){a&1&&(o(0,"tr")(1,"th"),l(2,"ID"),t(),o(3,"th"),l(4,"Nombre"),t(),o(5,"th"),l(6,"Documento"),t(),o(7,"th",4),l(8,"Acciones"),t()())}function st(a,e){if(a&1){let n=R();o(0,"tr",5)(1,"td",6),l(2),S(3,"fallback"),t(),o(4,"td",7),l(5),S(6,"fallback"),t(),o(7,"td",8),l(8),S(9,"fallback"),t(),o(10,"td",9)(11,"div",10)(12,"p-button",11),f("click",function(s){let r=A(n).$implicit,C=O();return F(C.onEdit(r,s))}),t(),o(13,"p-button",12),f("click",function(s){let r=A(n).$implicit,C=O();return F(C.onDelete(r,s))}),t()()()()}if(a&2){let n=e.$implicit;d("pSelectableRow",n),m(2),$(J(3,4,n.id,"Sin ID")),m(3),$(J(6,7,n.name,"Sin nombre")),m(3),$(J(9,10,n.documentNumber,"Sin Documento"))}}var ne=class a{_list=[];set list(e){this._list=e}action=new Se;constructor(){}ngOnChanges(e){console.log("Me cambi\xE9",e)}onEdit(e,n){n.stopPropagation(),this.action.emit({type:"edit",value:e})}onDelete(e,n){n.stopPropagation(),this.action.emit({type:"delete",value:e})}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=_({type:a,selectors:[["app-customer-table"]],inputs:{list:"list"},outputs:{action:"action"},features:[_e],decls:4,vars:3,consts:[[1,"table-wrapper"],["responsiveLayout","stack","breakpoint","768px",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[2,"text-align","center"],[3,"pSelectableRow"],["data-label","ID"],["data-label","Nombre"],["data-label","Documento"],["data-label","Acciones",2,"text-align","center"],[1,"action-buttons"],["icon","pi pi-pencil","styleClass","p-button-text p-button-edit",3,"click"],["icon","pi pi-trash","styleClass","p-button-text p-button-delete",3,"click"]],template:function(n,i){n&1&&(o(0,"div",0)(1,"p-table",1),c(2,mt,9,0,"ng-template",2)(3,st,14,13,"ng-template",3),t()()),n&2&&(m(),d("value",i._list)("tableStyle",P(2,lt)))},dependencies:[x,Te,M,y,w,I,D,T,k,Ve,Ue,E,N,Ge],encapsulation:2})};var dt=()=>[];function pt(a,e){a&1&&(ye(0),o(1,"div",4),u(2,"p-progressSpinner",5),t(),Me())}function ct(a,e){if(a&1){let n=R();o(0,"app-customer-table",6),S(1,"async"),f("action",function(s){A(n);let r=O();return F(r.onListAction(s))}),t()}if(a&2){let n=O();d("list",H(1,1,n.customers$)||P(3,dt))}}var $e=class a{constructor(e,n,i,s){this.appService=e;this.dialogService=n;this.confirmationService=i;this.uiService=s;this.loading$=this.uiService.loading$}customers$=new Ce([]);loading$;destroy$=new ve;ref=null;ngOnInit(){this.loadCustomers()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.ref?.close()}loadCustomers(){this.uiService.setLoading(!0),this.appService.customerApiService.listCustomer().pipe(j(this.destroy$)).subscribe({next:e=>this.customers$.next(e),error:e=>{this.uiService.showError("Error al cargar clientes",e.error?.message||"No se pudo obtener la lista")},complete:()=>this.uiService.setLoading(!1)})}onStartAddAction(){this.ref=this.dialogService.open(ie,{header:"Agregar Cliente",closable:!0,height:"80dvh",width:"70dvh"}),this.ref.onClose.pipe(j(this.destroy$)).subscribe(e=>{e?.success&&this.loadCustomers(),this.ref=null})}onEdit(e){this.ref=this.dialogService.open(oe,{data:{customer:e},header:"Editar Cliente",closable:!0,height:"90dvh",width:"70dvh"}),this.ref.onClose.pipe(j(this.destroy$)).subscribe(n=>{n?.success&&this.loadCustomers(),this.ref=null})}onDelete(e){e?.id&&this.confirmationService.confirm({message:`\xBFEst\xE1s seguro de que quer\xE9s eliminar al cliente <b>${e.name}</b>? Esta acci\xF3n no se puede deshacer.`,header:"Eliminar cliente",icon:"pi pi-trash",acceptLabel:"Eliminar",rejectLabel:"Cancelar",acceptButtonStyleClass:"p-button-danger custom-confirm-btn",rejectButtonStyleClass:"p-button-secondary custom-cancel-btn",accept:()=>{this.uiService.setLoading(!0),this.appService.customerApiService.deleteCustomer(e.id).pipe(j(this.destroy$)).subscribe({next:()=>{this.uiService.showSuccess("Eliminado",`${e.name} fue eliminado correctamente.`),this.loadCustomers()},error:n=>this.uiService.showError("Error al eliminar",n.error?.message||"No se pudo eliminar el cliente"),complete:()=>this.uiService.setLoading(!1)})}})}onListAction(e){switch(e.type){case"edit":this.onEdit(e.value);break;case"delete":this.onDelete(e.value);break;default:console.warn("Acci\xF3n no reconocida:",e.type)}}static \u0275fac=function(n){return new(n||a)(p(W),p(Re),p(Ie),p(L))};static \u0275cmp=_({type:a,selectors:[["app-customer-page"]],decls:9,vars:7,consts:[["tableContent",""],[2,"display","flex","justify-content","space-between","align-items","center","margin-bottom","1rem"],["icon","pi pi-plus","label","Agregar","styleClass","p-button-outlined p-button-plain",3,"click","disabled"],[4,"ngIf","ngIfElse"],[2,"display","flex","justify-content","center","align-items","center","height","50vh"],["strokeWidth","4"],[3,"action","list"]],template:function(n,i){if(n&1){let s=R();o(0,"div",1)(1,"h1"),l(2,"Clientes"),t(),o(3,"p-button",2),S(4,"async"),f("click",function(){return A(s),F(i.onStartAddAction())}),t()(),c(5,pt,3,0,"ng-container",3),S(6,"async"),c(7,ct,2,4,"ng-template",null,0,xe)}if(n&2){let s=Ee(8);m(3),d("disabled",H(4,3,i.loading$)),m(2),d("ngIf",H(6,5,i.loading$))("ngIfElse",s)}},dependencies:[we,x,M,y,w,I,D,T,k,E,N,ne,B,K,Le,We],encapsulation:2})};export{$e as CustomerPage};
